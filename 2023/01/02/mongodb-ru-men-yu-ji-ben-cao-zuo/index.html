<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="MongoDB 入门与基本操作, PHP,Java,Go,MySQL,Linux,Docker等"><meta name="description" content="PHP Java Go MySQL 后端开发"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>MongoDB 入门与基本操作 | 一代键客</title><link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico"><link rel="stylesheet" href="/libs/awesome/css/all.css"><link rel="stylesheet" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" href="/libs/aos/aos.css"><link rel="stylesheet" href="/libs/animate/animate.min.css"><link rel="stylesheet" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="/css/matery.css"><link rel="stylesheet" href="/css/my.css"><script src="/libs/jquery/jquery.min.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><meta name="generator" content="Hexo 5.4.2"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="一代键客" type="application/atom+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><div><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="/medias/log.png" class="logo-img" alt="LOGO"> <span class="logo-span">一代键客</span></div></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="/medias/log.png" class="logo-img circle responsive-img"><div class="logo-name">一代键客</div><div class="logo-desc">PHP Java Go MySQL 后端开发</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li><div class="divider"></div></li><li><a href="https://github.com/dendi875" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/dendi875" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/featureimages/14.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">MongoDB 入门与基本操作</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{padding:35px 0 15px 17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{padding-bottom:30px;overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/MongoDB/"><span class="chip bg-color">MongoDB</span></a> <a href="/tags/NoSQL/"><span class="chip bg-color">NoSQL</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/MongoDB/" class="post-category">MongoDB</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2023-01-02</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i> 更新日期:&nbsp;&nbsp; 2023-02-06</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 2.1k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 8 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i> 阅读次数:&nbsp;&nbsp;<span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="/libs/prism/prism.css"><div class="card-content article-card-content"><div id="articleContent"><h2 id="关于-mongodb"><a class="markdownIt-Anchor" href="#关于-mongodb"></a> 关于 MongoDB</h2><table><thead><tr><th>什么是 MongoDB</th><th>一个以 JSON 为数据模型的文档数据库</th></tr></thead><tbody><tr><td>为什么叫文档数据库</td><td>文档来自于 <code>JSON Document</code>，并非我们一般理解的 PDF,WORD 文档</td></tr><tr><td>谁开发 MongoDB？</td><td>上市公司 MongoDB inc.，总部位于美国纽约</td></tr><tr><td>主要用途</td><td>应用数据库，类似于 MySQL<br>海量数据处理，数据平台</td></tr><tr><td>主要特点</td><td>建模为可选<br>JSON 数据模型比较适合开发者<br>横向扩展可以支撑很大数据量和并发<br>4.x 版本支持分布式事务</td></tr><tr><td>MongoDB 是免费的吗？</td><td>MongoDB 有两个发布版本：社区版和企业版。<br>社区版是基于SSPL，一种和AGPL基本类似的开源协议<br>企业版是基于商业协议，需付费使用</td></tr></tbody></table><h2 id="mongodb-vs-关系型数据库"><a class="markdownIt-Anchor" href="#mongodb-vs-关系型数据库"></a> MongoDB VS 关系型数据库</h2><table><thead><tr><th></th><th>MongoDB</th><th>关系型数据库</th></tr></thead><tbody><tr><td>数据模型</td><td>文档模型</td><td>关系模型</td></tr><tr><td>数据库类型</td><td>OLTP（on-line transaction processing）</td><td>OLTP</td></tr><tr><td>CRUD 操作</td><td>MQL/SQL</td><td>SQL</td></tr><tr><td>高可用</td><td>复制集</td><td>集群模式</td></tr><tr><td>横向扩展能力</td><td>通过原生分片完善支持</td><td>数据分区或者应用侵入式</td></tr><tr><td>索引支持</td><td>B-树、全文索引、地理位置索引、多键（multikey）索引、TTL索引</td><td>B树</td></tr><tr><td>开发难度</td><td>容易</td><td>困难</td></tr><tr><td>数据容量</td><td>没有理论上限</td><td>千万、亿</td></tr><tr><td>扩展方式</td><td>垂直扩展+水平扩展</td><td>垂直扩展</td></tr></tbody></table><h2 id="mongodb-技术优势"><a class="markdownIt-Anchor" href="#mongodb-技术优势"></a> MongoDB 技术优势</h2><ul><li>JSON 结构和对象模型接近，开发代码量低</li><li>JSON 的动态模型意味着更容易响应新的业务需求</li><li>复制集提供 99.999% 高可用</li><li>分片架构支持海量数据和无缝扩容</li></ul><h2 id="在-macos-上安装并运行-mongodb"><a class="markdownIt-Anchor" href="#在-macos-上安装并运行-mongodb"></a> 在 MacOS 上安装并运行 MongoDB</h2><p>安装：<a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/how-to-install-mongodb-on-macos/">https://www.geeksforgeeks.org/how-to-install-mongodb-on-macos/</a></p><p>运行：</p><ul><li><strong>运行 Mongo 守护进程</strong>，在你的一个终端窗口中执行 <code>mongod</code>。 这应该启动 Mongo 服务器。</li><li><strong>运行 Mongo shell</strong>，在一个终端中运行 Mongo 守护进程，在另一个终端窗口中执行 <code>mongo</code>。 这将运行 Mongo shell，这是一个访问 MongoDB 中数据的应用程序。</li><li><strong>退出 Mongo shell</strong> 运行<code>quit()</code></li><li><strong>要停止 Mongo 守护进程</strong>，请按 <code>ctrl-c</code></li></ul><h2 id="mongodb-基本操作"><a class="markdownIt-Anchor" href="#mongodb-基本操作"></a> MongoDB 基本操作</h2><h3 id="使用-insert-完成插入操作"><a class="markdownIt-Anchor" href="#使用-insert-完成插入操作"></a> 使用 <code>insert</code> 完成插入操作</h3><p>操作格式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>集合<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token constant">JSON</span>对象<span class="token operator">&gt;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>集合<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token constant">JSON</span> <span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token constant">JSON</span> <span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token operator">&lt;</span><span class="token constant">JSON</span> <span class="token constant">N</span><span class="token operator">&gt;</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">"apple"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>fruit<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
		<span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">"apple"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">"pear"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">"orange"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查看插入的数据：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.find()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="使用-find-查询文档"><a class="markdownIt-Anchor" href="#使用-find-查询文档"></a> 使用 <code>find</code> 查询文档</h3><p>关于 find：</p><ul><li>find 是 MongoDB 中查询数据的基本指令，相当于 SQL 中的 SELECT。</li><li>find 返回的是游标。</li></ul><p>find 示例：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.movies.find({"year": 1975}) // 单条查询
db.movies.find({"year": 1989, "title": "Batman"}) // 多条件 and 查询
db.movies.find({$and:[{"title": "Batman"}, {"category": "action"}]}) // and 的另一种形式，给一个 and，and 里是数组
db.movies.find({$or:[{"year": 1989}, {"title": "Batman"}]}) // 多条件 or 查询
db.movies.find({"title": /^B/}) // 按正则表达式查询<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="查询条件对照表"><a class="markdownIt-Anchor" href="#查询条件对照表"></a> 查询条件对照表</h3><table><thead><tr><th style="text-align:center">SQL</th><th style="text-align:center">MQL</th></tr></thead><tbody><tr><td style="text-align:center">a = 1</td><td style="text-align:center">{a: 1}</td></tr><tr><td style="text-align:center">a &lt;&gt; 1</td><td style="text-align:center">{a: {$ne : 1}}</td></tr><tr><td style="text-align:center">a &gt; 1</td><td style="text-align:center">{a: {$gt: 1}}</td></tr><tr><td style="text-align:center">a &gt;= 1</td><td style="text-align:center">{a: {$gte: 1}}</td></tr><tr><td style="text-align:center">a &lt; 1</td><td style="text-align:center">{a: {$lt: 1}}</td></tr><tr><td style="text-align:center">a &lt;= 1</td><td style="text-align:center">{a: {$lte: 1}}</td></tr><tr><td style="text-align:center">a = 1 AND b = 1</td><td style="text-align:center">{a: 1, b: 1} 或 {$and: [{a: 1}, {b: 1}]}</td></tr><tr><td style="text-align:center">a = 1 OR b = 1</td><td style="text-align:center">{$or: [{a: 1}, {b: 1}]}</td></tr><tr><td style="text-align:center">a IS NULL</td><td style="text-align:center">{a: {$exists: false}}</td></tr><tr><td style="text-align:center">a IN (1, 2, 3)</td><td style="text-align:center">{a: {$in: [1, 2, 3]}}</td></tr></tbody></table><h3 id="查询逻辑运算符"><a class="markdownIt-Anchor" href="#查询逻辑运算符"></a> 查询逻辑运算符</h3><ul><li>$lt: 存在并小于</li><li>$lte: 存在并小于等于</li><li>$gt: 存在并大于</li><li>$gte: 存在并大于等于</li><li>$ne: 不存在或存在但不等于</li><li>$in: 存在并在指定的数组中</li><li>$nin: 不存在或不在指定的数组中</li><li>$or: 匹配两个或多个条件中的任何一个</li><li>$and: 匹配全部条件</li></ul><h3 id="使用-find-搜索子文档"><a class="markdownIt-Anchor" href="#使用-find-搜索子文档"></a> 使用 <code>find</code> 搜索子文档</h3><h4 id="find-支持使用-fieldsub_field的形式查询子文档"><a class="markdownIt-Anchor" href="#find-支持使用-fieldsub_field的形式查询子文档"></a> find 支持使用 <code>field.sub_field</code>的形式查询子文档</h4><p>我们先删除 fruit 这个表：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.drop()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>假设有一个文档：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.insertOne({
    "name": "apple",
    "from": {
        "country": "China",
        "province": "Guangdon"
    }
})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先查看插入的数据：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.find()
{ "_id" : ObjectId("6370d4bc4835f42d80eba3bb"), "name" : "apple", "from" : { "country" : "China", "province" : "Guangdon" } }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>以下查询的意义分别为：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.find({"from.country": "China"})<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>该查询表示：我要查一个子文档 “from.country”</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.find({"from": {"country": "China"}}) // 找不到文档<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>该查询表示：我要找的文档里有一个字段是<code>"from"</code>，它的值是 <code>{"country": "China"}</code></p><h4 id="find-支持对数组中元素进行搜索"><a class="markdownIt-Anchor" href="#find-支持对数组中元素进行搜索"></a> find 支持对数组中元素进行搜索</h4><p>假设有一个文档：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.insert([
  {"name": "Apple", color: ["red", "green"]},
  {"name": "Mango", color: ["yello", "green"]}
])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>以下查询的意义分别为：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.find({color: "red"}) 
{ "_id" : ObjectId("6370d5984835f42d80eba3bc"), "name" : "Apple", "color" : [ "red", "green" ] }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>该查询表示：找的文档有 color 这个字段，且值有 red</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.find({$or: [{color: "red"}, {color: "yello"}]})
{ "_id" : ObjectId("6370d5984835f42d80eba3bc"), "name" : "Apple", "color" : [ "red", "green" ] }
{ "_id" : ObjectId("6370d5984835f42d80eba3bd"), "name" : "Mango", "color" : [ "yello", "green" ] }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>该查询表示：找的文档有 color 这个字段，值要么是 red，要么是 yello</p><p>我们再看一个查询：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.movies.insertOne({
	"title": "Raiders of the Lost Ark",
	"filming_locations": [
			{"city": "Los Angeles", "state": "CA", "country": "USA"},
			{"city": "Rome", "state": "Lazio", "country": "Italy"},
			{"city": "Florence", "state": "SC", "country": "USA"}
	]
})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查找城市是 Rome 的记录：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.movies.find({"filming_locations.city": "Rome"})  // 使用 字段名.子文档 的方式来查找<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="使用-find-搜索数组中的对象"><a class="markdownIt-Anchor" href="#使用-find-搜索数组中的对象"></a> 使用 <code>find</code> 搜索数组中的对象</h3><p>在数组中搜索子对象的多个字段时，如果使用 <code>$elemMatch</code>，它表示必须是同一个子对象满足多个条件。</p><p>例如下面两个查询：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.getCollection('movies').find({
	"filming_locations.city": "Rome",
	"filming_locations.country": "USA"
})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>该查询表示：子文档有 “city” 这个字段且值为 “Rome”，或者有 “country” 这个字段且值为 “USA”</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.getCollection('movies').find({
	"filming_locations.city": {
		$elemMatch: {"city": "Rome", "country": "USA"}
	}
})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该查询表示：子文档不仅要满足有 “city” 这个字段且值为 “Rome”，还要满足有 “country” 这个字段且值为 “USA”</p><h3 id="控制-find-返回的字段"><a class="markdownIt-Anchor" href="#控制-find-返回的字段"></a> 控制 <code>find</code> 返回的字段</h3><p>find 可以指定只返回指定的字段，<code>_id</code> 字段必须明确指定不返回，否则默认返回，在 MongoDB 中指定我们想要返回的字段，称为投影（projection）。</p><p>如下示例：指定不返回 _id，返回 title：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.movies.find({}, {"_id": 0, title: 1})  // 把条件置为空<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我们可以看到如果要返回的字段的话文档是有多个字段：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.movies.find().pretty()
{
        "_id" : ObjectId("6370d8c34835f42d80eba3be"),
        "title" : "Raiders of the Lost Ark",
        "filming_locations" : [
                {
                        "city" : "Los Angeles",
                        "state" : "CA",
                        "country" : "USA"
                },
                {
                        "city" : "Rome",
                        "state" : "Lazio",
                        "country" : "Italy"
                },
                {
                        "city" : "Florence",
                        "state" : "SC",
                        "country" : "USA"
                }
        ]
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用-remove-删除文档"><a class="markdownIt-Anchor" href="#使用-remove-删除文档"></a> 使用 <code>remove</code> 删除文档</h3><p>remove 命令需要配合查询条件使用，匹配查询条件的文档会被删除，<strong>指定一个空文档查询条件会删除所有文档</strong>。</p><p>如下示例：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.testcol.remove({a: 1}) // 删除 a等于1 的记录
db.testcol.remove({a: {$lt: 5}}) // 删除 a小于5 的记录
db.testcol.remove({}) // 删除所有记录
db.testcol.remove() // 报错<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用-update-更新文档"><a class="markdownIt-Anchor" href="#使用-update-更新文档"></a> 使用 <code>update</code> 更新文档</h3><p>操作格式：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.&lt;集合&gt;.update(&lt;查询条件&gt;, &lt;更新字段&gt;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.insertMany([
	{name: "apple"},
	{name: "pear"},
	{name: "orange"}
])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查询 name 为 apple 的记录，将找到记录的 from 设置为 China（新加一个字段 from）：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.updateOne({name: "apple"}, {$set: {from: "China"}})<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>$set</code> 命令表示我要更新一个字段的值，该字段可以不存在。</p><h4 id="注意点"><a class="markdownIt-Anchor" href="#注意点"></a> 注意点</h4><ul><li><p>使用 <code>updateOne</code> 表示无论条件匹配多少条记录，始终只更新第一条。</p></li><li><p>使用 <code>updateMany</code> 表示条件匹配多少条就更新多少条。</p></li><li><p><code>updateOne/updateMany</code> 方法要求<strong>更新条件部分</strong>必须具有以下之一，否则将报错：</p><ul><li><code>$set/$unset</code></li><li><code>$push/$pushAll/$pop</code></li><li><code>$pull/$pushAll</code></li><li><code>$addToSet</code></li></ul><table><thead><tr><th>操作符</th><th>含义</th></tr></thead><tbody><tr><td>$push</td><td>增加一个对象到数组底部</td></tr><tr><td>$pushAll</td><td>增加多个对象到数组底部</td></tr><tr><td>$pop</td><td>从数组底部删除一个对象</td></tr><tr><td>$pull</td><td>如果匹配指定的值，从数组中删除相应的对象</td></tr><tr><td>$pullAll</td><td>如果匹配任意的值，从数组中删除相应的对象</td></tr><tr><td>$addToSet</td><td>如果不存在则增加一个值到数组中</td></tr></tbody></table></li></ul><p>以下更新将报错：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.updateOne({name: "apple"}, {from: "China"})<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="使用-drop-删除集合表"><a class="markdownIt-Anchor" href="#使用-drop-删除集合表"></a> 使用 <code>drop</code> 删除集合（表）</h2><p>集合中的全部文档都会被删除，集合相关的索引也会被删除。</p><p>操作格式：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.&lt;集合&gt;.drop()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.fruit.drop()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="使用-dropdatabase-删除数据库"><a class="markdownIt-Anchor" href="#使用-dropdatabase-删除数据库"></a> 使用 <code>dropDatabase</code> 删除数据库</h2><p>数据库相应文件被删除，磁盘空间将被翻译。</p><p>操作格式：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">db.droopDatabase()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&gt; show dbs
admin   0.000GB
config  0.000GB
local   0.000GB
mock    0.047GB
test    0.000GB
&gt; use test
switched to db test
&gt; show collections   // 与 show tables 一个意思
movies
&gt; db								// 显示当前所在的数据库
test
&gt; db.dropDatabase()
{ "dropped" : "test", "ok" : 1 }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2><ul><li><a target="_blank" rel="noopener" href="https://www.mongodb.com/docs/v4.2/crud/">https://www.mongodb.com/docs/v4.2/crud/</a></li><li><a target="_blank" rel="noopener" href="https://www.mongodb.com/docs/v4.2/reference/operator/">https://www.mongodb.com/docs/v4.2/reference/operator/</a></li><li><a target="_blank" rel="noopener" href="https://www.mongodb.com/docs/v4.2/reference/sql-comparison/">https://www.mongodb.com/docs/v4.2/reference/sql-comparison/</a></li><li><a target="_blank" rel="noopener" href="https://www.mongodb.com/docs/v4.2/crud/">https://www.mongodb.com/docs/v4.2/crud/</a></li></ul></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">张权</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://www.zhangquan.me/2023/01/02/mongodb-ru-men-yu-ji-ben-cao-zuo/">https://www.zhangquan.me/2023/01/02/mongodb-ru-men-yu-ji-ben-cao-zuo/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">张权</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/MongoDB/"><span class="chip bg-color">MongoDB</span></a> <a href="/tags/NoSQL/"><span class="chip bg-color">NoSQL</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.valine-card{margin:1.5rem auto}.valine-card .card-content{padding:20px 20px 5px 20px}#vcomments textarea{box-sizing:border-box;background:url(https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/comment_bg.png) 100% 100% no-repeat}#vcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem}#vcomments blockquote p{text-indent:.2rem}#vcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#vcomments img{max-width:100%;height:auto;cursor:pointer}#vcomments ol li{list-style-type:decimal}#vcomments ol,ul{display:block;padding-left:2em;word-spacing:.05rem}#vcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#vcomments ul li{list-style-type:disc}#vcomments ul ul li{list-style-type:circle}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#vcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#vcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#vcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#vcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#vcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#vcomments h6{font-size:1rem;line-height:1.3rem}#vcomments p{font-size:1rem;line-height:1.5rem}#vcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#vcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#vcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#vcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#vcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#vcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#vcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#vcomments b,strong{font-weight:700}#vcomments dfn{font-style:italic}#vcomments small{font-size:85%}#vcomments cite{font-style:normal}#vcomments mark{background-color:#fcf8e3;padding:.2em}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card valine-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="vcomments" class="card-content" style="display:grid"></div></div><script src="/libs/valine/av-min.js"></script><script src="https://unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"s8QEmTF1Slf32CctOSsFuvXe-gzGzoHsz",appKey:"sDkuaBSVzI8HdhP09aPoMjYV",notify:!1,verify:!1,visitor:!0,avatar:"monsterid",pageSize:"10",lang:"zh-cn",placeholder:"昵称填写qq可以显示qq头像和昵称哦~ ",enableQQ:!0,emojiCDN:"//i0.hdslb.com/bfs/emote/",emojiMaps:{tv_doge:"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_惊吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_打脸":"56ab10b624063e966bfcb76ea5dc4794d87dfd47.png","tv_抓狂":"fe31c08edad661d63762b04e17b8d5ae3c71a757.png","tv_抠鼻":"c666f55e88d471e51bbd9fab9bb308110824a6eb.png","tv_斜眼笑":"911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png","tv_无奈":"ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png","tv_晕":"5443c22b4d07fb1907ccc610c8e6db254f2461b7.png","tv_流汗":"cead1c351ab8d79e9f369605beb90148db0fbed3.png","tv_流泪":"7e71cde7858f0cd50d74b0264aa26db612a8a167.png","tv_流鼻血":"c32d39db2737f89b904ca32700d140a9241b0767.png","tv_点赞":"f85c354995bd99e28fc76c869bfe42ba6438eff4.png","tv_生气":"26702dcafdab5e8225b43ffd23c94ac1ff932654.png","tv_生病":"8b0ec90e6b86771092a498c54f09fc94621c1900.png","tv_疑问":"0793d949b18d7be716078349c202c15ff166f314.png","tv_白眼":"c1d59f439e379ee50eef488bcb5e5378e5044ea4.png","tv_皱眉":"72ccad6679fea0d14cce648b4d818e09b8ffea2d.png","tv_目瞪口呆":"0b8cb81a68de5d5365212c99375e7ace3e7891b7.png","tv_睡着":"8b196675b53af58264f383c50ad0945048290b33.png","tv_笑哭":"1abc628f6d4f4caf9d0e7800878f4697abbc8273.png","tv_腼腆":"89712c0d4af73e67f89e35cbc518420380a7f6f4.png","tv_色":"61822c7e9aae5da76475e7892534545336b23a6f.png","tv_调侃":"4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png","tv_调皮":"b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png","tv_鄙视":"6e72339f346a692a495b123174b49e4e8e781303.png","tv_闭嘴":"c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png","tv_难过":"87f46748d3f142ebc6586ff58860d0e2fc8263ba.png","tv_馋":"fc7e829b845c43c623c8b490ee3602b7f0e76a31.png","tv_鬼脸":"0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png","tv_黑人问号":"45821a01f51bc867da9edbaa2e070410819a95b2.png","tv_鼓掌":"1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png"},requiredFields:["nick","mail"]})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/2023/02/06/mongodb-ju-he/"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/featureimages/12.jpg" class="responsive-img" alt="MongoDB 聚合"> <span class="card-title">MongoDB 聚合</span></div></a><div class="card-content article-content"><div class="summary block-with-text">MongoDB 聚合</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2023-02-06</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/MongoDB/" class="post-category">MongoDB</a></span></div></div><div class="card-action article-tags"><a href="/tags/MongoDB/"><span class="chip bg-color">MongoDB</span></a> <a href="/tags/NoSQL/"><span class="chip bg-color">NoSQL</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/2022/12/25/istio-liu-liang-jing-xiang/"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/featureimages/15.jpg" class="responsive-img" alt="Istio 流量镜像"> <span class="card-title">Istio 流量镜像</span></div></a><div class="card-content article-content"><div class="summary block-with-text">Istio 流量镜像</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2022-12-25</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Istio/" class="post-category">Istio</a></span></div></div><div class="card-action article-tags"><a href="/tags/Istio/"><span class="chip bg-color">Istio</span></a> <a href="/tags/Kubernetes/"><span class="chip bg-color">Kubernetes</span></a> <a href="/tags/Service-Mesh/"><span class="chip bg-color">Service Mesh</span></a></div></div></div></div></article></div><script src="/libs/codeBlock/codeBlockFuction.js"></script><script src="/libs/codeBlock/codeLang.js"></script><script src="/libs/codeBlock/codeCopy.js"></script><script src="/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["(",")"]]}})</script><footer class="page-footer bg-color"><link rel="stylesheet" href="/libs/aplayer/APlayer.min.css"><style>.aplayer .aplayer-lrc p{display:none;font-size:12px;font-weight:700;line-height:16px!important}.aplayer .aplayer-lrc p.aplayer-lrc-current{display:none;font-size:15px;color:#42b983}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div><div class="row"><meting-js class="col l8 offset-l2 m10 offset-m1 s12" server="netease" type="playlist" id="503838841" fixed="true" autoplay theme="#42b983" loop order="random" preload="auto" volume="0.7" list-folded="true"></meting-js></div></div><script src="/libs/aplayer/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2021-2023</span> <a href="/about" target="_blank">张权</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">191.2k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span></span> <span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=new Date,t="2021",n=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),r=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),g=Date.UTC(t,"6","28","0","0","0"),d=Date.UTC(n,i,a,r,s,o)-g,m=Math.floor(d/31536e6),l=Math.floor(d/864e5-365*m);if(t===String(n)){document.getElementById("year").innerHTML=n;var c="This site has been running for "+l+" days";c="本站已运行 "+l+" 天",document.getElementById("sitetime").innerHTML=c}else{document.getElementById("year").innerHTML=t+" - "+n;var u="This site has been running for "+m+" years and "+l+" days";u="本站已运行 "+m+" 年 "+l+" 天",document.getElementById("sitetime").innerHTML=u}};calcSiteTime()</script><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/dendi875" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:dendi875@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=943299849" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 943299849" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><script language="javascript">function siteTime(){window.setTimeout("siteTime()",1e3);var e=36e5,t=24*e,o=new Date,i=o.getFullYear(),a=o.getMonth()+1,n=o.getDate(),r=o.getHours(),l=o.getMinutes(),s=o.getSeconds(),M=Date.UTC(2021,11,9,0,0,0),g=Date.UTC(i,a,n,r,l,s)-M,m=Math.floor(g/31536e6),T=Math.floor(g/t-365*m),f=Math.floor((g-(365*m+T)*t)/e),h=Math.floor((g-(365*m+T)*t-f*e)/6e4),u=Math.floor((g-(365*m+T)*t-f*e-6e4*h)/1e3);document.getElementById("sitetime").innerHTML="本站已运行 "+m+" 年 "+T+" 天 "+f+" 小时 "+h+" 分钟 "+u+" 秒"}siteTime()</script><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,a,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),r=document.getElementById(a),n=document.getElementById(s);r.addEventListener("input",function(){var f='<ul class="search-result-list">',m=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var r=!0,n=t.title.trim().toLowerCase(),a=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),e=t.url;e=0===e.indexOf("/")?t.url:"/"+e;var s=-1,i=-1,l=-1;if(""!==n&&""!==a&&m.forEach(function(t,e){s=n.indexOf(t),i=a.indexOf(t),s<0&&i<0?r=!1:(i<0&&(i=0),0===e&&(l=i))}),r){f+="<li><a href='"+e+"' class='search-result-title'>"+n+"</a>";var c=t.content.trim().replace(/<[^>]+>/g,"");if(0<=l){var u=l-20,o=l+80;u<0&&(u=0),0===u&&(o=100),o>c.length&&(o=c.length);var h=c.substr(u,o);m.forEach(function(t){var e=new RegExp(t,"gi");h=h.replace(e,'<em class="search-keyword">'+t+"</em>")}),f+='<p class="search-result">'+h+"...</p>"}f+="</li>"}}),f+="</ul>",n.innerHTML=f)})}})}("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script src="/libs/instantpage/instantpage.js" type="module"></script><script>var st,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="Σ(っ °Д °;)っ喔哟，崩溃啦！",clearTimeout(st)):(document.title="φ(゜▽゜*)♪咦，又好了！",st=setTimeout(function(){document.title=OriginTitile},3e3))})</script><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,c=(r.imageLazyLoadSetting.preloadRatio,n());function n(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=n());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight+240||document.documentElement.clientHeight+240)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e()},t.src!==a&&(n.src=a))}()}function a(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",a),r.addEventListener("resize",a),r.addEventListener("orientationchange",a)}(this)</script></body></html>