<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="Istio 入门及核心功能介绍, PHP,Java,Go,MySQL,Linux,Docker等"><meta name="description" content="PHP Java Go MySQL 后端开发"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>Istio 入门及核心功能介绍 | 一代键客</title><link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico"><link rel="stylesheet" href="/libs/awesome/css/all.css"><link rel="stylesheet" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" href="/libs/aos/aos.css"><link rel="stylesheet" href="/libs/animate/animate.min.css"><link rel="stylesheet" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="/css/matery.css"><link rel="stylesheet" href="/css/my.css"><script src="/libs/jquery/jquery.min.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><meta name="generator" content="Hexo 5.4.2"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="一代键客" type="application/atom+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><div><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="/medias/log.png" class="logo-img" alt="LOGO"> <span class="logo-span">一代键客</span></div></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="/medias/log.png" class="logo-img circle responsive-img"><div class="logo-name">一代键客</div><div class="logo-desc">PHP Java Go MySQL 后端开发</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li><div class="divider"></div></li><li><a href="https://github.com/dendi875" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/dendi875" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/featureimages/2.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Istio 入门及核心功能介绍</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{padding:35px 0 15px 17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{padding-bottom:30px;overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Istio/"><span class="chip bg-color">Istio</span></a> <a href="/tags/Kubernetes/"><span class="chip bg-color">Kubernetes</span></a> <a href="/tags/Service-Mesh/"><span class="chip bg-color">Service Mesh</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Istio/" class="post-category">Istio</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2022-09-25</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i> 更新日期:&nbsp;&nbsp; 2023-02-15</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 5.9k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 21 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i> 阅读次数:&nbsp;&nbsp;<span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="/libs/prism/prism.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="istio-入门及核心功能介绍"><a class="markdownIt-Anchor" href="#istio-入门及核心功能介绍"></a> Istio 入门及核心功能介绍</h1><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925170849.png" alt=""></p><p>现在最火的后端架构无疑是<strong>微服务</strong>了，微服务将之前的单体应用拆分成了许多独立的服务，好处自然很多，但是随着应用的越来越大，微服务暴露出来的问题也就随之而来了，微服务越来越多，管理越来越麻烦，特别是要你部署一套新环境的时候，你就能体会到这种痛苦了，随之而来的<strong>服务发现、负载均衡、Trace跟踪、流量管理、安全认证等等</strong>问题。如果从头到尾完成过一套微服务框架的话，你就会知道这里面涉及到的东西真的非常多。对于 Java 领域来说还有 Spring Cloud 这种完整的微服务框架，但是也仅仅局限于 Java 语言。当然随着微服务的不断发展，微服务的生态也不断完善，最近就发现新一代的微服务开发就悄然兴起了，那就是 Service Mesh（服务网格）。</p><p>而 istio 是现在最热门的 Service Mesh 工具，istio 是由 Google、IBM、Lyft 等共同开源的 Service Mesh（服务网格）框架，于2017年初开始进入大众视野。Kubernetes 解决了云原生应用的部署问题，istio 解决的是应用的服务（流量）治理问题。所以我们完全有必要去学习了解 istio，因为这就是微服务领域的下一个标准。</p><h2 id="什么是-istio"><a class="markdownIt-Anchor" href="#什么是-istio"></a> 什么是 Istio</h2><p>官方定义：它是一个完全开源的<strong>服务网格</strong>，作为<strong>透明</strong>的一层接入到现有的分布式应用中。它也是一个平台，可以与任何日志、遥测和策略系统进行集成。Istio 多样化的特性让你能够成功且高效地运行<strong>微服务架构</strong>，并<strong>提供保护、连接和监控微服务</strong>的统一方法。</p><p>我们从官方定义中可以罗列下 Istio 的几个核心要点：</p><ul><li>它依然是一个服务网格产品</li><li>它拥有服务网格的基本特性（对应用层是透明的）</li><li>它是为微服务架构来服务的</li><li>它可以连接、控制、保护、观测微服务系统</li></ul><h2 id="istio-名字来源"><a class="markdownIt-Anchor" href="#istio-名字来源"></a> Istio 名字来源</h2><p>Istio 并不是一个英语单词，而是来源于希腊语，它的意思是扬帆起航，从 Istio 的 Logo 中也可以看到它是一个船的「帆」，Kubernetes 也起源于希腊语，它的意思和 Logo 也是一样的「舵」即舵手的意思，Google 为什么用 Istio 来给这个产品命名，其实是非常有深意的，它的意思是你不仅有 Kubernetes 这个舵，还得有 Istio 这个帆，由它们一起驾驶着你的云原生应用扬帆起航，Istio 也被称作是第二代的 Service Mesh，在原来数据平面的基础上增加了控制平面，它为现代的 Service Mesh 的产品定义了一个新的形态。</p><h2 id="istio-核心功能"><a class="markdownIt-Anchor" href="#istio-核心功能"></a> Istio 核心功能</h2><h3 id="流量控制"><a class="markdownIt-Anchor" href="#流量控制"></a> 流量控制</h3><p>流量控制顾名思义就是对流量请求进行控制和管理，拿交通为例，红绿灯其实就是用来管理交通流量的一种手段，家里用的路由器或者说是设置黑白名单也是一种流量控制的手段，Istio 提供的流量控制能力非常强大除了基本的<strong>服务发现和负载均衡</strong>以外，还有以下四个功能：</p><ul><li>路由、流量转移：我们经常听到的像灰度发布、蓝绿部署、AB测试都是基于它演变出来的</li><li>流量进出：我们可以用 API 网关对流量进出进行管理</li><li>网络弹性能力：对网络增加了一些弹性能力，比如超时、重试、熔断这样的机制</li><li>测试相关：提供了一些调试网格的特性，比如故障注入、流量镜像这样的功能</li></ul><p>熔断：它是一个非常重要的过载保护机制，可以让客户端快速失败，而不去访问出现问题的服务端，这样可以把整个系统的故障控制在一定范围之内。</p><p>故障注入：它可以故意地给你的服务植入一些故障，比如，增加你服务的延迟、或者直接让你的服务中断（比如直接返回500错误），通过故障注入的方式可以模拟你服务出现问题时整个应用是如何处理的。</p><p>流量镜像：我们很难在本地的开发环境中去模拟线上环境，有的时候本地测试的没有任务问题，但系统部署到了线上就会出现问题，这是因为环境不同以及流量不同，而流量镜像这个功能可以完全地把生产环境的流量镜像一份，然后发送到你的镜像服务中，这样就可以在镜像服务中来调试线上环境可能出现的问题。</p><p>Istio 提供的流量控制能力主要由以下这些自定义资源来实现：</p><ul><li><p>核心资源（CRD）</p><ul><li><p>虚拟服务（Virtual Service）</p></li><li><p>目标规则（Destination Rule）</p></li><li><p>网关（Gateway）</p></li><li><p>服务入口（Service Entry）</p></li><li><p>Sidecar</p></li></ul></li></ul><p>其中虚拟服务和目标规则主要是用来管理网格内部的流量，而网关是用来管理网格以外的流量，服务入口则面向的主要是服务，Sidecar 它是对流量进行一个全局的控制。</p><h4 id="虚拟服务virtual-service"><a class="markdownIt-Anchor" href="#虚拟服务virtual-service"></a> 虚拟服务（Virtual Service）</h4><p>虚拟服务是实现路由功能的重要组件，它主要的功能是把请求的流量路由到指定的目标地址，它可以做到把请求的地址和真实的工作负载进行解藕，本质上来讲它就是一组路由规则。</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925173836.png" alt=""></p><p>如上图展示了一个虚拟服务，它里面定义了两个不同的路由规则，其中规则1会把请求指向目标地址A，规则2会把请求指向目标地址B。</p><p>虚拟服务通常和目标规则（Destination Rule）成对出现，它提供了丰富的路由匹配规则，比如可以针对 Endpoint、针对 Uri、针对 Header 这样不同粒度的路由进行匹配。</p><h4 id="目标规则destination-rule"><a class="markdownIt-Anchor" href="#目标规则destination-rule"></a> 目标规则（Destination Rule）</h4><p>目标规则定义了虚拟服务里面配置的具体的目标地址，在它的配置中是以<strong>子集</strong>这个概率存在的，也就是每个子集里会配置一个对应的目标地址。</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925175600.png" alt=""></p><p>如上图所示，上半部分是虚拟服务，而下面虚线框内表示的就是具体的目标规则，在目标地址A中定义了两个子集A1和A2，目标地址B中定义了另外两个子集B1和B2，目标规则除了能定义子集，还可以<strong>对负载均衡的策略进行修改</strong>，默认情况下是以轮巡的方式进行负载均衡的，你可以配置使用随机、权重、最少请求数这样的方式进行负载均衡。</p><h4 id="网关gateway"><a class="markdownIt-Anchor" href="#网关gateway"></a> 网关（Gateway）</h4><p>Istio 内部定义的这个 Gateway 和我们平常所说的 API 网关本质是一个东西，它同样存在于整个网格的边界，用来管理进出的流量。</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925180353.png" alt=""></p><p>如上图所示，有两个网关，其中负责管理流量进入的网关叫 Ingress，管理流量出去的网关叫 Egress，Egress 网关并不是必选项，你可以不去使用它，内部服务的流量可以直接指向外部服务。我们可以通过网关来管理内部流量一样来管理网格外的流量，比如说为进出的流量增加负载均衡的能力，增加超时重试这样的能力，Istio 内部预定了两个网关分别是 Ingress Gateway 和 Egress Gateway，你也可以自己去实现自己的Gateway。</p><h4 id="服务入口service-entry"><a class="markdownIt-Anchor" href="#服务入口service-entry"></a> 服务入口（Service Entry）</h4><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/istio-service-entry.png" alt=""></p><p>服务入口面向的主要是服务，它主要的功能是把外部的服务注册到网格内，这样你就可以像管理网格内部的服务一样去管理外部的服务，服务入口主要的功能有以下三点：</p><ul><li><p>它可以为外部的目标转发请求</p></li><li><p>它可以添加超时重试等策略</p></li><li><p>它可以扩展你的网格</p></li></ul><p>一个简单的例子比如你的服务部署在不同的集群中，那么你可以通过定义服务入口的方式把这几个不同的集群集中起来，共同用同一个网格进行管理。</p><h4 id="sidecar"><a class="markdownIt-Anchor" href="#sidecar"></a> Sidecar</h4><p>Sidecar 它是对流量进行一个全局的控制，而前几个资源它主要是做一些细粒度的控制，Sidecar 主要有以下两个功能：</p><ul><li>调整 Envoy 代理接管的端口和协议</li><li>限制 Envoy 代理可访问的服务</li></ul><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925182110.png" alt=""></p><p>默认情况下 Envoy 是接管所有发送到服务的请求的，而通过 Sidecar 你可以调整接管流量的范围，比如上图所示的，我们只监听来自于端口 9080 的HTTP协议，另外它还可以限制 Envoy 代理可访问的服务，默认情况下 Envoy 是可以访问整个网格内的所有的服务，假设你可以像上图所示，让它只访问服务A而切断它对服务B的访问权限。</p><h3 id="可观察性"><a class="markdownIt-Anchor" href="#可观察性"></a> 可观察性</h3><p>有一句话是这样描述的：能够在生产环境中监控系统的运行状态比在开发环境中完整地测试所有的功能更重要。如果你仔细体会一下就会发现这句话非常有道理，在生产环境中对于服务的观察是非常重要的，特别是对于微服务这样的架构来说，因为服务很多又比较分散，服务本身又是多样化的，所以能够了解整个应用的状态是非常重要的，</p><h4 id="什么是可观察性"><a class="markdownIt-Anchor" href="#什么是可观察性"></a> 什么是可观察性？</h4><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925192235.png" alt=""></p><p>云原生基金会（CNCF）在 18 年的时候把可观察性作为了自己蓝图中的一个模块，有些人一提到可观察性就说这不就是监控嘛，实际上它和监控还是有非常大的区别，监控指的是从运维人员的角度去审视系统的行为，审核系统的状态，它是一个被动的方式，是从系统之外去探究系统的运行状态。而可观察性是指从开发人员的角度主动地去探究系统的运行情况，对于开发人员来说，研发是他的主要工作，他需要在自己的开发过程中主动地去考虑把哪些系统的指标暴露出去，而在以前我们只是通过记录日志的方式去查看系统运行的情况，可观察性的出现无疑不是一种巨大的进步。</p><p>一般情况我们把可观察性分为指标、日志收集和分布式追踪。</p><h4 id="指标"><a class="markdownIt-Anchor" href="#指标"></a> 指标</h4><p>指标又叫度量，它指的是以聚合数据的方式来理解和查看系统的行为，举个例子，我们可以在系统运行的过程中在一些时间点上做一些记录，然后把这些生成的数据统一起来，最后就能以一个趋势图的方式来展示系统在这段时间中运行的状态。</p><p>Istio 中的指标主要分为三类：</p><ul><li>代理级别的指标（Proxy-level）</li><li>服务级别的指标（Service-level）</li><li>控制平面指标（Control plane）</li></ul><h5 id="代理级别的指标"><a class="markdownIt-Anchor" href="#代理级别的指标"></a> 代理级别的指标</h5><p>代理级别的指标顾名思义就是用来收集 Sidecar 代理上的一些数据，Sidecar 代理会接管所有来自于服务的请求，因此有很多丰富的数据供我们收集，我们还可以指定让某一个或者某几个 Sidecar 进行指标的收集，这样方便我们进行一些问题的调试。</p><p>代理级别指标的例子：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">envoy_cluster_internal_upstream_rq<span class="token punctuation">{</span>response_code_class<span class="token operator">=</span><span class="token string">"2xx"</span>,cluster_name<span class="token operator">=</span><span class="token string">"xds-grpc"</span><span class="token punctuation">}</span> <span class="token number">7163</span>

envoy_cluster_upstream_rq_completed<span class="token punctuation">{</span>cluster_name<span class="token operator">=</span><span class="token string">"xds-grpc"</span><span class="token punctuation">}</span> <span class="token number">7164</span>

envoy_cluster_ssl_connection_error<span class="token punctuation">{</span>cluster_name<span class="token operator">=</span><span class="token string">"xds-grpc"</span><span class="token punctuation">}</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面列举了三个比较典型的代理级别的指标，第一个指标是当前集群中来自于上游服务的总的请求数量，第二个指标是上游服务的完成的请求数量，第三个SSL连接出错的数量。</p><h5 id="服务级别的指标"><a class="markdownIt-Anchor" href="#服务级别的指标"></a> 服务级别的指标</h5><p>服务级别的指标主要是用来收集服务本身的一些信息，主要是根据延迟、流量、错误、饱和这四个服务的基本监控需求来进行收集，默认认情况下这些指标数据会导出到 Prometheus，当然你也可以自定义或修改，服务级别的指标不一定输出，你可以根据情况进行开启或关闭。</p><p>服务级别指标的例子：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">istio_requests_total<span class="token punctuation">{</span>
  <span class="token assign-left variable">connection_security_policy</span><span class="token operator">=</span><span class="token string">"mutual_tls"</span>,  <span class="token comment"># 连接的安全策略是双向tls</span>
  <span class="token assign-left variable">destination_app</span><span class="token operator">=</span><span class="token string">"details"</span>,
  <span class="token assign-left variable">destination_canonical_service</span><span class="token operator">=</span><span class="token string">"details"</span>,
  <span class="token assign-left variable">destination_canonical_revision</span><span class="token operator">=</span><span class="token string">"v1"</span>,
  <span class="token assign-left variable">destination_principal</span><span class="token operator">=</span><span class="token string">"cluster.local/ns/default/sa/default"</span>,
  <span class="token assign-left variable">destination_service</span><span class="token operator">=</span><span class="token string">"details.default.svc.cluster.local"</span>,
  <span class="token assign-left variable">destination_service_name</span><span class="token operator">=</span><span class="token string">"details"</span>,
  <span class="token assign-left variable">destination_service_namespace</span><span class="token operator">=</span><span class="token string">"default"</span>,
  <span class="token assign-left variable">destination_version</span><span class="token operator">=</span><span class="token string">"v1"</span>,
  <span class="token assign-left variable">destination_workload</span><span class="token operator">=</span><span class="token string">"details-v1"</span>,
  <span class="token assign-left variable">destination_workload_namespace</span><span class="token operator">=</span><span class="token string">"default"</span>,
  <span class="token assign-left variable">reporter</span><span class="token operator">=</span><span class="token string">"destination"</span>,
  <span class="token assign-left variable">request_protocol</span><span class="token operator">=</span><span class="token string">"http"</span>, <span class="token comment"># 请求的协议</span>
  <span class="token assign-left variable">response_code</span><span class="token operator">=</span><span class="token string">"200"</span>, <span class="token comment"># response 的响应码</span>
  <span class="token assign-left variable">response_flags</span><span class="token operator">=</span><span class="token string">"-"</span>,
  <span class="token assign-left variable">source_app</span><span class="token operator">=</span><span class="token string">"productpage"</span>,
  <span class="token assign-left variable">source_canonical_service</span><span class="token operator">=</span><span class="token string">"productpage"</span>,
  <span class="token assign-left variable">source_canonical_revision</span><span class="token operator">=</span><span class="token string">"v1"</span>,
  <span class="token assign-left variable">source_principal</span><span class="token operator">=</span><span class="token string">"cluster.local/ns/default/sa/default"</span>,
  <span class="token assign-left variable">source_version</span><span class="token operator">=</span><span class="token string">"v1"</span>,
  <span class="token assign-left variable">source_workload</span><span class="token operator">=</span><span class="token string">"productpage-v1"</span>,
  <span class="token assign-left variable">source_workload_namespace</span><span class="token operator">=</span><span class="token string">"default"</span>
<span class="token punctuation">}</span> <span class="token number">214</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面演示了一个服务级别的指标 istio_requests_total，它主要包含以下信息，比如说连接的安全策略是双向tls，以及目标地址的详细信息，还有请求的协议是 http，response 的响应码是 200。</p><h5 id="控制平面指标"><a class="markdownIt-Anchor" href="#控制平面指标"></a> 控制平面指标</h5><p>除了通过代理级别的指标和服务级别的指标来监控应用的状态，你还可以收集控制平面的指标来监控 Istio 本身的运行状况，这样你就可以了解到整个网格的健康情况，</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925195258.png" alt=""></p><p>上图显示的是 Istio 官方文档提供的一些控制平台的指标，有关这些被维护指标的更多信息，请查看<a target="_blank" rel="noopener" href="https://istio.io/latest/zh/docs/reference/commands/pilot-discovery/#metrics">参考文档</a>。</p><h4 id="日志收集"><a class="markdownIt-Anchor" href="#日志收集"></a> 日志收集</h4><p>指标是通过聚合的数据来监测你的应用运行情况，而日志指的是通过系统产生的事件来监控你的应用。</p><p>Istio 里提供的访问日志包括了非常完整的元数据信息，比如说请求的来源以及目标地址，同时你还可以对日志产生的位置进行设置，可以把它保存在本地，也可以把它直接导入到远程的第三方工具里（如 ELK、EFK）。</p><p>一般来说日志内容主要包括两部分，一部分是应用本身的日志，就是开发人员在开发应用时自己输出的一些 Log，另一部分是Envoy产生的信息，它会对请求产生的数据进行一个详细地记录，查看的方式也非常简单，直接通 kubectl 的 logs 命令对 Envoy 的 Container 进行查看就可以了。</p><p>Envoy 日志查看示例：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubectl logs -l <span class="token assign-left variable">app</span><span class="token operator">=</span>demo -c istio-proxy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="分布式追踪"><a class="markdownIt-Anchor" href="#分布式追踪"></a> 分布式追踪</h4><p>分布工追踪通过追踪请求来了解服务之间的调用关系，我们主要把分布式追踪用于问题的排查以及性能分析方面。</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925200515.png" alt=""></p><p>如上图所示，左图中是一个没有使用分布式跟踪的应用，当第一个节点出现问题时候，你不知道具体的问题出现在哪个服务中，因为你没有办法追踪它，只能通过不停的尝试来发现问题的所在。而在右图中是使用了分布式追踪的一个系统，一旦你的第一个节点出现了问题，你能通过分布式追踪系统很快地发现在调用链上是哪个节点出现了问题，非常的方便和高效。</p><p>我们经常在开发中遇到这样的案例，你负责服务A，调用你的人跑过来说你的服务出现了问题，通过排错你发现实际上出现问题的是你调用的服务B，于是你又跑去找服务B，服务B的开发者经过调试，发现实际上是它的调用的服务C出了问题，这样的案例很常见，整个问题排查的过程是非常低效的，但有了分布式追踪系统就可以极大地提升排查问题的效率，也可以避免被别人甩锅，你可以把本属于你的锅甩给应该背锅的人。</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925201541.png" alt=""></p><p>上图是分布式追踪系统 Jeager 里的截图，可以从左边的部分看到整个服务的一个调用关系，以及整个服务执行完所需要的时间，每一个调用耗费了多少时间都列得非常清楚，一旦某个调用链出现了问题，也可以很快发现它的异常情况。</p><h3 id="安全"><a class="markdownIt-Anchor" href="#安全"></a> 安全</h3><p>安全对于一个互联网应用来说是非常重要的，因此 Service Mesh 技术也必须提供安全相关的功能，Istio 中的安全主要分为<strong>认证和授权</strong>两大部分，绝大部分功能是由 Istiod 这个控制平面来实现的。</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925202414.png" alt=""></p><p>上图为 Istio 官方提供的安全架构图，CA 主要用来负责证书的管理，认证策略和授权策略都会被存储在对应的模块中，由API Server 将这些策略变成配置下发到对应的数据平面中，当一个终端用户调用网格内服务的时候，它可以使用经典的 JWT 方式进行认证，而网格内服务与服务之间可以使用双向TLS进行认证。</p><h4 id="认证"><a class="markdownIt-Anchor" href="#认证"></a> 认证</h4><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925203158.png" alt=""></p><p>如上图所示，管理员配置了两种策略，一种是针对 Foo 这个 Namespace，它的目标是全体的服务，另外一种策略是针对 Bar 这个Namespace，它的目标是 Workload X，这些策略会被转变成具体的配置信息，然后由 istiod 下发给具体的 Sidecar 代理，Istio 在认证中提供了一种兼容的模式，你可以以不加密的方式和加密的方式同时进行请求的传输，这为我们进行安全设置方面的调试带来了很大的便利性，比如当我们想要增加 mTLS 这样的认证策略的时候，我们可以先用纯文本的方式测试服务之间的连通性，然后再把这个策略加上去。</p><p>Istio 认证主要包括两种：</p><ul><li>对等认证</li></ul><p>对等认证也就是我们平时所说的传输身份认证，它主要的功能是用于服务与服务之间的身份认证，目前 Istio 支持以 mTLS （Mutual TLS）这样的方式进行认证。</p><ul><li>请求认证</li></ul><p>请求认证也就是我们通常所说的终端用户认证，它主要是用于给终端用户访问我们的服务进行认证的，目前 Istio 支持的是 JWT （JSON Web Token）这种非常流行的方式。</p><p>对于不同的认证方式我们需要建立对应的 CRD，比如说我们要配置一个对等认证就需要构建一个 PeerAuthentication 这样一个 CRD，同时我们需要指定它的生效范围，认证配置的生效范围主要有三点，第一种就是在全网格内生效，第二种就是在当前的命名空间生效，比如下面的示例中是在 namespace foo 里生效，另外我们还可以进一步指定具体的工作负载，在下面的配置中我们指定了一个选择器，这样的话配置就只针对标签为 reviews 的服务来生效。</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token string">"security.istio.io/v1beta1"</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> <span class="token string">"PeerAuthentication"</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"example-peer-policy"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token string">"foo"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> reviews
  <span class="token key atrule">mtls</span><span class="token punctuation">:</span>
    <span class="token key atrule">mode</span><span class="token punctuation">:</span> STRICT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>具体的配置策略就是最下面的 mtls ，它的模式是严格模式，也可以修改成兼容模式，一旦策略进行了更新，Istio 几乎会实时地将这些策略推送到具体的数据平面中，但是 Istio 它不能保证同时更新所有的数据平面，这个时候你就需要注意避免策略的中断，一般情况下推荐两种方式：</p><p>如果是对等认证，你需要设置 MTLS 那么这个时候你最好使用兼容模式，等调试完成之后再使用严格模式。</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925205342.png" alt=""></p><p>如果是身份认证，你可以把新旧两个 JWT 同时配置进你的策略当中，当请求全部迁移到新的JWT里面之后，再把旧的删除就可以了。</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925205532.png" alt=""></p><h4 id="授权"><a class="markdownIt-Anchor" href="#授权"></a> 授权</h4><p>授权分了三个级别，分别是针对网格，针对命名空间，以及服务进行授权。</p><p><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/images/PicGo/20220925205953.png" alt=""></p><p>如上图所示，当管理员增加一个授权策略的时候，API Server 会把策略转换成对应的配置，然后下发给对应的数据平面的 Sidecar，每个 Sidecar 会运行一个授权引擎，该引擎在运行的时候进行授权请求，如果请求到达代理时，授权引擎根据当前的策略评估请求上下文并返回授权的结果，授权在默认情况下无需你显式地启动，默认就是启动状态。</p><p>下面我们来看看授权策略是如何配置的？</p><p>授权策略的配置需要通过创建一个叫 AuthorizationPolicy 的 CRD，这个 CRD 主要有以下组成部分</p><ul><li>选择器（selector）：指定策略的目标</li><li>动作（action）：可以配置允许或者拒绝两种行为</li><li>具体的规则列表（rules）：指定何时触发动作，规则列表包括三部分内容<ul><li><code>from</code> 字段指定请求的来源</li><li><code>to</code> 字段指定请求的具体操作</li><li><code>when</code> 字段代表具体的匹配条件</li></ul></li></ul><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> security.istio.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> AuthorizationPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> httpbin
 <span class="token key atrule">namespace</span><span class="token punctuation">:</span> foo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
 <span class="token key atrule">selector</span><span class="token punctuation">:</span>
   <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
     <span class="token key atrule">app</span><span class="token punctuation">:</span> httpbin
     <span class="token key atrule">version</span><span class="token punctuation">:</span> v1
 <span class="token key atrule">action</span><span class="token punctuation">:</span> ALLOW
 <span class="token key atrule">rules</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">source</span><span class="token punctuation">:</span>
       <span class="token key atrule">principals</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"cluster.local/ns/default/sa/sleep"</span><span class="token punctuation">]</span>
   <span class="token punctuation">-</span> <span class="token key atrule">source</span><span class="token punctuation">:</span>
       <span class="token key atrule">namespaces</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"dev"</span><span class="token punctuation">]</span>
   <span class="token key atrule">to</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">operation</span><span class="token punctuation">:</span>
       <span class="token key atrule">methods</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span>
   <span class="token key atrule">when</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> request.auth.claims<span class="token punctuation">[</span>iss<span class="token punctuation">]</span>
     <span class="token key atrule">values</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"https://accounts.google.com"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>授权策略的设置方式也很多：</p><ul><li><p>范围（目标）设置：主要通过 metadata/namespace，selector 来指定具体的服务</p><p>以下示例策略 <code>allow-read</code> 允许对 <code>default</code> 命名空间中带有标签 <code>app: products</code> 的工作负载的 <code>"GET"</code> 和 <code>"HEAD"</code> 访问。</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> security.istio.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> AuthorizationPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> allow<span class="token punctuation">-</span>read
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> products
  <span class="token key atrule">action</span><span class="token punctuation">:</span> ALLOW
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">operation</span><span class="token punctuation">:</span>
         <span class="token key atrule">methods</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"HEAD"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>值匹配：精确、模糊、前缀、后缀</p><p>以下示例策略允许访问前缀为 <code>/test/*</code> 或后缀为 <code>*/info</code> 的路径。</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> security.istio.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> AuthorizationPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tester
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> products
  <span class="token key atrule">action</span><span class="token punctuation">:</span> ALLOW
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">operation</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"/test/*"</span><span class="token punctuation">,</span> <span class="token string">"*/info"</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>全部容许和拒绝</p><p>以下示例显示了一个简单的 <code>allow-all</code> 授权策略，该策略允许完全访问 <code>default</code> 命名空间中的所有工作负载。</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> security.istio.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> AuthorizationPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> allow<span class="token punctuation">-</span>all
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">action</span><span class="token punctuation">:</span> ALLOW
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>自定义条件</p><p>您还可以使用 <code>when</code> 部分指定其他条件。 例如，下面的 <code>AuthorizationPolicy</code> 定义包括以下条件：<code>request.headers [version]</code> 是 <code>v1</code> 或 <code>v2</code>。 在这种情况下，key 是 <code>request.headers [version]</code>，它是 Istio 属性 <code>request.headers</code>（是个字典）中的一项。</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> security.istio.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> AuthorizationPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> httpbin
 <span class="token key atrule">namespace</span><span class="token punctuation">:</span> foo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
 <span class="token key atrule">selector</span><span class="token punctuation">:</span>
   <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
     <span class="token key atrule">app</span><span class="token punctuation">:</span> httpbin
     <span class="token key atrule">version</span><span class="token punctuation">:</span> v1
 <span class="token key atrule">action</span><span class="token punctuation">:</span> ALLOW
 <span class="token key atrule">rules</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">source</span><span class="token punctuation">:</span>
       <span class="token key atrule">principals</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"cluster.local/ns/default/sa/sleep"</span><span class="token punctuation">]</span>
   <span class="token key atrule">to</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">operation</span><span class="token punctuation">:</span>
       <span class="token key atrule">methods</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span>
   <span class="token key atrule">when</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> request.headers<span class="token punctuation">[</span>version<span class="token punctuation">]</span>
     <span class="token key atrule">values</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"v1"</span><span class="token punctuation">,</span> <span class="token string">"v2"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="策略"><a class="markdownIt-Anchor" href="#策略"></a> 策略</h3><ul><li><p>限流</p></li><li><p>黑白名单</p></li></ul><h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2><ul><li><a target="_blank" rel="noopener" href="https://istio.io/latest/zh/docs/concepts/traffic-management/">https://istio.io/latest/zh/docs/concepts/traffic-management/</a></li><li><a target="_blank" rel="noopener" href="https://istio.io/latest/zh/docs/concepts/observability/">https://istio.io/latest/zh/docs/concepts/observability/</a></li><li><a target="_blank" rel="noopener" href="https://istio.io/latest/zh/docs/concepts/security/">https://istio.io/latest/zh/docs/concepts/security/</a></li></ul></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">张权</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://www.zhangquan.me/2022/09/25/istio-ru-men-ji-he-xin-gong-neng-jie-shao/">https://www.zhangquan.me/2022/09/25/istio-ru-men-ji-he-xin-gong-neng-jie-shao/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">张权</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Istio/"><span class="chip bg-color">Istio</span></a> <a href="/tags/Kubernetes/"><span class="chip bg-color">Kubernetes</span></a> <a href="/tags/Service-Mesh/"><span class="chip bg-color">Service Mesh</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.valine-card{margin:1.5rem auto}.valine-card .card-content{padding:20px 20px 5px 20px}#vcomments textarea{box-sizing:border-box;background:url(https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/comment_bg.png) 100% 100% no-repeat}#vcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem}#vcomments blockquote p{text-indent:.2rem}#vcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#vcomments img{max-width:100%;height:auto;cursor:pointer}#vcomments ol li{list-style-type:decimal}#vcomments ol,ul{display:block;padding-left:2em;word-spacing:.05rem}#vcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#vcomments ul li{list-style-type:disc}#vcomments ul ul li{list-style-type:circle}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#vcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#vcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#vcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#vcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#vcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#vcomments h6{font-size:1rem;line-height:1.3rem}#vcomments p{font-size:1rem;line-height:1.5rem}#vcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#vcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#vcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#vcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#vcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#vcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#vcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#vcomments b,strong{font-weight:700}#vcomments dfn{font-style:italic}#vcomments small{font-size:85%}#vcomments cite{font-style:normal}#vcomments mark{background-color:#fcf8e3;padding:.2em}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card valine-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="vcomments" class="card-content" style="display:grid"></div></div><script src="/libs/valine/av-min.js"></script><script src="https://unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"s8QEmTF1Slf32CctOSsFuvXe-gzGzoHsz",appKey:"sDkuaBSVzI8HdhP09aPoMjYV",notify:!1,verify:!1,visitor:!0,avatar:"monsterid",pageSize:"10",lang:"zh-cn",placeholder:"昵称填写qq可以显示qq头像和昵称哦~ ",enableQQ:!0,emojiCDN:"//i0.hdslb.com/bfs/emote/",emojiMaps:{tv_doge:"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_惊吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_打脸":"56ab10b624063e966bfcb76ea5dc4794d87dfd47.png","tv_抓狂":"fe31c08edad661d63762b04e17b8d5ae3c71a757.png","tv_抠鼻":"c666f55e88d471e51bbd9fab9bb308110824a6eb.png","tv_斜眼笑":"911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png","tv_无奈":"ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png","tv_晕":"5443c22b4d07fb1907ccc610c8e6db254f2461b7.png","tv_流汗":"cead1c351ab8d79e9f369605beb90148db0fbed3.png","tv_流泪":"7e71cde7858f0cd50d74b0264aa26db612a8a167.png","tv_流鼻血":"c32d39db2737f89b904ca32700d140a9241b0767.png","tv_点赞":"f85c354995bd99e28fc76c869bfe42ba6438eff4.png","tv_生气":"26702dcafdab5e8225b43ffd23c94ac1ff932654.png","tv_生病":"8b0ec90e6b86771092a498c54f09fc94621c1900.png","tv_疑问":"0793d949b18d7be716078349c202c15ff166f314.png","tv_白眼":"c1d59f439e379ee50eef488bcb5e5378e5044ea4.png","tv_皱眉":"72ccad6679fea0d14cce648b4d818e09b8ffea2d.png","tv_目瞪口呆":"0b8cb81a68de5d5365212c99375e7ace3e7891b7.png","tv_睡着":"8b196675b53af58264f383c50ad0945048290b33.png","tv_笑哭":"1abc628f6d4f4caf9d0e7800878f4697abbc8273.png","tv_腼腆":"89712c0d4af73e67f89e35cbc518420380a7f6f4.png","tv_色":"61822c7e9aae5da76475e7892534545336b23a6f.png","tv_调侃":"4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png","tv_调皮":"b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png","tv_鄙视":"6e72339f346a692a495b123174b49e4e8e781303.png","tv_闭嘴":"c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png","tv_难过":"87f46748d3f142ebc6586ff58860d0e2fc8263ba.png","tv_馋":"fc7e829b845c43c623c8b490ee3602b7f0e76a31.png","tv_鬼脸":"0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png","tv_黑人问号":"45821a01f51bc867da9edbaa2e070410819a95b2.png","tv_鼓掌":"1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png"},requiredFields:["nick","mail"]})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/2022/09/25/istio-de-an-zhuang-he-bu-shu/"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/featureimages/6.jpg" class="responsive-img" alt="Istio的安装和部署"> <span class="card-title">Istio的安装和部署</span></div></a><div class="card-content article-content"><div class="summary block-with-text">Istio的安装和部署</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2022-09-25</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Istio/" class="post-category">Istio</a></span></div></div><div class="card-action article-tags"><a href="/tags/Istio/"><span class="chip bg-color">Istio</span></a> <a href="/tags/Kubernetes/"><span class="chip bg-color">Kubernetes</span></a> <a href="/tags/Service-Mesh/"><span class="chip bg-color">Service Mesh</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/2022/09/09/prometheus-operator-de-an-zhuang/"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/dendi875/dendi875.github.io/medias/featureimages/6.jpg" class="responsive-img" alt="Prometheus Operator 的安装"> <span class="card-title">Prometheus Operator 的安装</span></div></a><div class="card-content article-content"><div class="summary block-with-text">Prometheus Operator 的安装</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2022-09-09</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Kubernetes/" class="post-category">Kubernetes</a></span></div></div><div class="card-action article-tags"><a href="/tags/Kubernetes/"><span class="chip bg-color">Kubernetes</span></a> <a href="/tags/Prometheus/"><span class="chip bg-color">Prometheus</span></a> <a href="/tags/Operator/"><span class="chip bg-color">Operator</span></a></div></div></div></div></article></div><script src="/libs/codeBlock/codeBlockFuction.js"></script><script src="/libs/codeBlock/codeLang.js"></script><script src="/libs/codeBlock/codeCopy.js"></script><script src="/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["(",")"]]}})</script><footer class="page-footer bg-color"><link rel="stylesheet" href="/libs/aplayer/APlayer.min.css"><style>.aplayer .aplayer-lrc p{display:none;font-size:12px;font-weight:700;line-height:16px!important}.aplayer .aplayer-lrc p.aplayer-lrc-current{display:none;font-size:15px;color:#42b983}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div><div class="row"><meting-js class="col l8 offset-l2 m10 offset-m1 s12" server="netease" type="playlist" id="503838841" fixed="true" autoplay theme="#42b983" loop order="random" preload="auto" volume="0.7" list-folded="true"></meting-js></div></div><script src="/libs/aplayer/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2021-2023</span> <a href="/about" target="_blank">张权</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">260.6k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span></span> <span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=new Date,t="2021",n=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),r=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),g=Date.UTC(t,"6","28","0","0","0"),d=Date.UTC(n,i,a,r,s,o)-g,m=Math.floor(d/31536e6),l=Math.floor(d/864e5-365*m);if(t===String(n)){document.getElementById("year").innerHTML=n;var c="This site has been running for "+l+" days";c="本站已运行 "+l+" 天",document.getElementById("sitetime").innerHTML=c}else{document.getElementById("year").innerHTML=t+" - "+n;var u="This site has been running for "+m+" years and "+l+" days";u="本站已运行 "+m+" 年 "+l+" 天",document.getElementById("sitetime").innerHTML=u}};calcSiteTime()</script><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/dendi875" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:dendi875@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=943299849" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 943299849" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><script language="javascript">function siteTime(){window.setTimeout("siteTime()",1e3);var e=36e5,t=24*e,o=new Date,i=o.getFullYear(),a=o.getMonth()+1,n=o.getDate(),r=o.getHours(),l=o.getMinutes(),s=o.getSeconds(),M=Date.UTC(2021,11,9,0,0,0),g=Date.UTC(i,a,n,r,l,s)-M,m=Math.floor(g/31536e6),T=Math.floor(g/t-365*m),f=Math.floor((g-(365*m+T)*t)/e),h=Math.floor((g-(365*m+T)*t-f*e)/6e4),u=Math.floor((g-(365*m+T)*t-f*e-6e4*h)/1e3);document.getElementById("sitetime").innerHTML="本站已运行 "+m+" 年 "+T+" 天 "+f+" 小时 "+h+" 分钟 "+u+" 秒"}siteTime()</script><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,a,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),r=document.getElementById(a),n=document.getElementById(s);r.addEventListener("input",function(){var f='<ul class="search-result-list">',m=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var r=!0,n=t.title.trim().toLowerCase(),a=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),e=t.url;e=0===e.indexOf("/")?t.url:"/"+e;var s=-1,i=-1,l=-1;if(""!==n&&""!==a&&m.forEach(function(t,e){s=n.indexOf(t),i=a.indexOf(t),s<0&&i<0?r=!1:(i<0&&(i=0),0===e&&(l=i))}),r){f+="<li><a href='"+e+"' class='search-result-title'>"+n+"</a>";var c=t.content.trim().replace(/<[^>]+>/g,"");if(0<=l){var u=l-20,o=l+80;u<0&&(u=0),0===u&&(o=100),o>c.length&&(o=c.length);var h=c.substr(u,o);m.forEach(function(t){var e=new RegExp(t,"gi");h=h.replace(e,'<em class="search-keyword">'+t+"</em>")}),f+='<p class="search-result">'+h+"...</p>"}f+="</li>"}}),f+="</ul>",n.innerHTML=f)})}})}("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script src="/libs/instantpage/instantpage.js" type="module"></script><script>var st,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="Σ(っ °Д °;)っ喔哟，崩溃啦！",clearTimeout(st)):(document.title="φ(゜▽゜*)♪咦，又好了！",st=setTimeout(function(){document.title=OriginTitile},3e3))})</script><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,c=(r.imageLazyLoadSetting.preloadRatio,n());function n(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=n());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight+240||document.documentElement.clientHeight+240)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e()},t.src!==a&&(n.src=a))}()}function a(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",a),r.addEventListener("resize",a),r.addEventListener("orientationchange",a)}(this)</script></body></html>